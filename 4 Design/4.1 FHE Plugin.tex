\section{Fully Homomorphic Encryption Library}

The topology of this Dart plugin is designed to create a clear separation of responsibilities among its components, as shown in Table \ref{table:class-structure}. It starts with the Dart Seal class, which serves as the main entry point for users. This class is responsible for creating and managing the underlying C objects that perform the core tasks of Fully Homomorphic Encryption (FHE). Next is the Dart adapter layer, Afhe. This layer defines a set of methods and attributes that allow users to create, modify, and delete C objects. Afhe serves as a middleman by converting high-level Dart commands into lower-level C function calls. This process allows users to avoid the complexities of the underlying implementation.

\input{4 Design/4.1 Topology Table}

The Foreign Function Interface (FFI) is essential in this architecture, as it routes method calls from Dart to the C interface layer, known as FHE. The FHE layer provides a C interface that gives access to the underlying C++ classes, making their functions available in a way that works with C-based languages and other systems. The FHE layer interacts with the C++ classes by wrapping their methods and properties in C functions. This approach was borrowed from the work of Alberto Ibarrondo and Alexander Viand \cite{Ibarrondo2021-Pyfhel} in 2021. By using references to objects in memory, this layer can call C++ methods directly, which helps maintain performance while ensuring memory safety. A significant benefit of this design is that the FHE layer uses pointer references to avoid unnecessary data copying. This allows direct manipulation of memory objects created by the C++ classes, providing quick and efficient access to FHE functions from environments where direct C++ interaction is not possible. The interface layer manages the creation, updating, and deletion of pointers in memory that correspond to allocated SEAL objects. This ensures that resources are used effectively, which is crucial for maintaining the performance and reliability of the encryption processes.

In order to inadvertently introduce breaking changes, unit tests ensure that the functional behavior of the library remains consistent and reliable throughout the development and release. Unit tests serve as a safety net. They ensure that existing features function as expected when new changes occur. This process reduces the risks of regressions. For SEAL, the authors developed a set of examples that walk the user through their APIs. As a part of the unit tests, we re-implemented these examples with our interface to increase our confidence that our implementation did not introduce any new or unexpected behaviors. For automation, GitHub Actions compiles and executes unit tests using GoogleTest \cite{GoogleTest} with CMake. There are 78 unit tests, 35 in C and 43 in Dart.

In order to distribute this plugin to Linux and multiple Android flavors, GitHub Actions employs Conan \cite{Conan}. Conan automates the management of dependencies and packaging, specifically addressing the versioning of Microsoft SEAL and other backend libraries. For Linux, Conan streamlines the building and packaging process by automatically resolving dependencies tailored to various distributions, such as Ubuntu, Fedora, and CentOS, while ensuring compatibility with different versions of Microsoft SEAL and system architectures (e.g., x86, ARM). Similarly, Conan simplifies cross-compilation for Android by allowing developers to specify configurations for various architectures and API levels, ensuring that the plugin can be compiled for the supported CPU architectures x86\_64, ARMv8, and ARMv7. The compiled binaries are all hosted on all platforms and are available for download for each release of the Dart plugin. When developers add the plugin to their dependencies, the binaries are pulled down from GitHub and stored within their local, versioned dependency cache. This automated approach enhances the consistency and reliability of the plugin across different environments, facilitating smoother deployment and easier updates for users.
